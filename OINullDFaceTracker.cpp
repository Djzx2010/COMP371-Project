#include "OINullDFaceTracker.hpp"


//This method is called by the contructor the generete the hardcoded set of faces
void openiss::OINullDFaceTracker::generateFaces()
{
	//Generating all the hardcoded points
	//P1
	openiss::Point2f p1;
	p1.x = -2.5f;
	p1.y = 5.25f;
	//P2
	openiss::Point2f p2;
	p2.x = -2.48f;
	p2.y = 4.6f;
	//P3
	openiss::Point2f p3;
	p3.x = -2.45f;
	p3.y = 4.0f;
	//P4
	openiss::Point2f p4;
	p4.x = -2.42f;
	p4.y = 3.5f;
	//P5
	openiss::Point2f p5;
	p5.x = -2.3f;
	p5.y = 3.2f;
	//P6
	openiss::Point2f p6;
	p6.x = -2.2f;
	p6.y = 2.75f;
	//P7
	openiss::Point2f p7;
	p7.x = -1.8f;
	p7.y = 2.4f;
	//P8
	openiss::Point2f p8;
	p8.x = -1.3f;
	p8.y = 1.6f;
	//P9
	openiss::Point2f p9;
	p9.x = -0.75f;
	p9.y = 1.0f;
	//P10
	openiss::Point2f p10;
	p10.x = 0.0f;
	p10.y = 0.9f;
	//P11
	openiss::Point2f p11;
	p11.x = 0.75f;
	p11.y = 1.0f;
	//P12
	openiss::Point2f p12;
	p12.x = 1.3f;
	p12.y = 1.6f;
	//P13
	openiss::Point2f p13;
	p13.x = 1.8f;
	p13.y = 2.4f;
	//P14
	openiss::Point2f p14;
	p14.x = 2.0f;
	p14.y = 2.75f;
	//P15
	openiss::Point2f p15;
	p15.x = 2.3f;
	p15.y = 3.2f;
	//P16
	openiss::Point2f p16;
	p16.x = 2.42f;
	p16.y = 3.5f;
	//P17
	openiss::Point2f p17;
	p17.x = 2.45f;
	p17.y = 4.0f;
	//P18
	openiss::Point2f p18;
	p18.x = 2.45f;
	p18.y = 4.0f;
	//P19
	openiss::Point2f p19;
	p19.x = 2.5f;
	p19.y = 5.25f;
	//P20
	openiss::Point2f p20;
	p20.x = 0.0f;
	p20.y = 8.5f;
	//P21
	openiss::Point2f p21;
	p21.x = -2.0f;
	p21.y = 4.6f;
	//P22
	openiss::Point2f p22;
	p22.x = -2.0f;
	p22.y = 6.4f;
	//P23
	openiss::Point2f p23;
	p23.x = -1.5f;
	p23.y = 6.5f;
	//P24
	openiss::Point2f p24;
	p24.x = -1.0f;
	p24.y = 6.5f;
	//P25
	openiss::Point2f p25;
	p25.x = -0.5f;
	p25.y = 6.2f;
	//P26
	openiss::Point2f p26;
	p26.x = -1.0f;
	p26.y = 6.1f;
	//P27
	openiss::Point2f p27;
	p27.x = -1.5f;
	p27.y = 6.1f;
	//P28
	openiss::Point2f p28;
	p28.x = -2.0f;
	p28.y = 6.05f;
	//P29
	openiss::Point2f p29;
	p29.x = 2.0f;
	p29.y = 4.6f;
	//P30
	openiss::Point2f p30;
	p30.x = 2.0f;
	p30.y = 6.4f;

	openiss::Point2f p31;
	p31.x = 1.5;
	p31.y = 6.5;

	openiss::Point2f p32;
	p32.x = 1.0;
	p32.y = 6.5;

	openiss::Point2f p33;
	p33.x = 0.5;
	p33.y = 6.2;

	openiss::Point2f p34;
	p34.x = 1.0;
	p34.y = 6.1;

	openiss::Point2f p35;
	p35.x = 1.5;
	p35.y = 6.1;

	openiss::Point2f p36;
	p36.x = 2.0;
	p36.y = 6.05;

	openiss::Point2f p37;
	p37.x = -1.8;
	p37.y = 5.6;

	openiss::Point2f p38;
	p38.x = -1.3;
	p38.y = 5.7;

	openiss::Point2f p39;
	p39.x = -1.1;
	p39.y = 5.6;

	openiss::Point2f p40;
	p40.x = -1.1;
	p40.y = 5.7;

	openiss::Point2f p41;
	p41.x = -1.1;
	p41.y = 5.8;

	openiss::Point2f p42;
	p42.x = -0.9;
	p42.y = 5.7;

	openiss::Point2f p43;
	p43.x = -0.7;
	p43.y = 5.6;

	openiss::Point2f p44;
	p44.x = -0.5;
	p44.y = 5.6;

	openiss::Point2f p45;
	p45.x = 1.8;
	p45.y = 5.6;

	openiss::Point2f p46;
	p46.x = 1.3;
	p46.y = 5.7;

	openiss::Point2f p47;
	p47.x = 1.1;
	p47.y = 5.6;

	openiss::Point2f p48;
	p48.x = 1.1;
	p48.y = 5.7;

	openiss::Point2f p49;
	p49.x = 1.1;
	p49.y = 5.8;

	openiss::Point2f p50;
	p50.x = 0.9;
	p50.y = 5.7;

	openiss::Point2f p51;
	p51.x = 0.7;
	p51.y = 5.6;

	openiss::Point2f p52;
	p52.x = 0.5;
	p52.y = 5.6;

	openiss::Point2f p53;
	p53.x = -0.6;
	p53.y = 4.0;

	openiss::Point2f p54;
	p54.x = -0.9;
	p54.y = 4.2;

	openiss::Point2f p55;
	p55.x = -0.7;
	p55.y = 4.6;

	openiss::Point2f p56;
	p56.x = 0.0;
	p56.y = 3.6;

	openiss::Point2f p57;
	p57.x = 0.6;
	p57.y = 4.0;

	openiss::Point2f p58;
	p58.x = 0.9;
	p58.y = 4.2;

	openiss::Point2f p59;
	p59.x = 0.7;
	p59.y = 4.6;

	// Smile
	openiss::Point2f p60s;
	p60s.x = -1.3;
	p60s.y = 3.2;

	openiss::Point2f p61s;
	p61s.x = 1.3;
	p61s.y = 3.2;

	openiss::Point2f p62s;
	p62s.x = -0.7;
	p62s.y = 3.1;

	openiss::Point2f p63s;
	p63s.x = -0.7;
	p63s.y = 2.6;

	openiss::Point2f p64s;
	p64s.x = -0.9;
	p64s.y = 2.4;

	openiss::Point2f p65s;
	p65s.x = -0.7;
	p65s.y = 3.1;

	openiss::Point2f p66s;
	p66s.x = 0.7;
	p66s.y = 2.6;

	openiss::Point2f p67s;
	p67s.x = 0.9;
	p67s.y = 2.4;

	openiss::Point2f p68s;
	p68s.x = -0.1;
	p68s.y = 3.1;

	openiss::Point2f p69s;
	p69s.x = 0.1;
	p69s.y = 3.1;

	openiss::Point2f p70s;
	p70s.x = -0.3;
	p70s.y = 0.5;

	openiss::Point2f p71s;
	p71s.x = 0;
	p71s.y = 2.5;

	openiss::Point2f p72s;
	p72s.x = 0;
	p72s.y = 2.3;


	// Neutral
	openiss::Point2f p60n;
	p60n.x = -1.3;
	p60n.y = 2.7;

	openiss::Point2f p61n;
	p61n.x = 1.3;
	p61n.y = 2.7;

	openiss::Point2f p62n;
	p62n.x = -0.7;
	p62n.y = 2.9;

	openiss::Point2f p63n;
	p63n.x = -0.65;
	p63n.y = 2.75;

	openiss::Point2f p64n;
	p64n.x = -0.7;
	p64n.y = 2.6;

	openiss::Point2f p65n;
	p65n.x = 0.7;
	p65n.y = 2.9;

	openiss::Point2f p66n;
	p66n.x = 0.65;
	p66n.y = 2.75;

	openiss::Point2f p67n;
	p67n.x = 0.7;
	p67n.y = 2.6;

	openiss::Point2f p68n;
	p68n.x = -0.1;
	p68n.y = 3.0;

	openiss::Point2f p69n;
	p69n.x = 0.1;
	p69n.y = 3.0;

	openiss::Point2f p70n;
	p70n.x = 0;
	p70n.y = 2.95;

	openiss::Point2f p71n;
	p71n.x = 0;
	p71n.y = 2.75;

	openiss::Point2f p72n;
	p72n.x = 0;
	p72n.y = 2.4;


	// Frown
	openiss::Point2f p60f;
	p60f.x = -1.2;
	p60f.y = 2.65;

	openiss::Point2f p61f;
	p61f.x = 1.2;
	p61f.y = 2.65;

	openiss::Point2f p62f;
	p62f.x = -0.5;
	p62f.y = 3.0;

	openiss::Point2f p63f;
	p63f.x = -0.45;
	p63f.y = 2.90;

	openiss::Point2f p64f;
	p64f.x = -0.45;
	p64f.y = 2.65;

	openiss::Point2f p65f;
	p65f.x = 0.5;
	p65f.y = 3.0;

	openiss::Point2f p66f;
	p66f.x = 0.45;
	p66f.y = 2.90;

	openiss::Point2f p67f;
	p67f.x = 0.45;
	p67f.y = 2.65;

	openiss::Point2f p68f;
	p68f.x = -0.2;
	p68f.y = 3.1;

	openiss::Point2f p69f;
	p69f.x = 0.2;
	p69f.y = 3.1;

	openiss::Point2f p70f;
	p70f.x = 0;
	p70f.y = 3.05;

	openiss::Point2f p71f;
	p71f.x = 0;
	p71f.y = 2.95;

	openiss::Point2f p72f;
	p72f.x = 0;
	p72f.y = 2.6;

	//Array of points common to every face
	openiss::Point2f basePoints[] = { p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,
		p28,p29,p30,p31,p32,p33,p34,p35,p36,p37,p38,p39,p40,p41,p42,p43,p44,p45,p46,p47,p48,p49,p50,p51,p52,p53,p54,p55,p56,p57,p58,p59 };

	//Array of points for the mouth (smile)
	openiss::Point2f smilePoints[] = { p60s,p61s,p62s,p63s,p64s,p65s,p66s,p67s,p68s,p69s,p70s,p71s,p72s };

	//Array of points for the mouth (neutral)
	openiss::Point2f neutralPoints[] = { p60n,p61n,p62n,p63n,p64n,p65n,p66n,p67n,p68n,p69n,p70n,p71n,p72n };

	//Array of points for the mouth (frown)
	openiss::Point2f frownPoints[] = { p60f,p61f,p62f,p63f,p64f,p65f,p66f,p67f,p68f,p69f,p70f,p71f,p72f };

	int numberOfFaces = 7;
	int pointsForMouth = 13;

	for (int i = 0; i < numberOfFaces; i++) {

		OIFace* newFace = new OIFace();

		vector<openiss::Point2f>* newVector = new vector<openiss::Point2f>;

		oiface->push_back(newFace);

		oiface->at(i)->facialLandmarks->push_back(*newVector);

		oiface->at(i)->facialLandmarks->at(0).insert(oiface->at(i)->facialLandmarks->at(0).begin(), basePoints, basePoints + 59);

		if (i == 0) {
			for (int j = 0; j < pointsForMouth; j++) {
				oiface->at(i)->facialLandmarks->at(0).push_back(smilePoints[j]);
			}
		}
		else if (i == 1) {
			for (int j = 0; j < pointsForMouth; j++) {
				openiss::Point2f point;
				point.x = smilePoints[j].x + (neutralPoints[j].x - smilePoints[j].x) / 3;
				point.y = smilePoints[j].y + (neutralPoints[j].y - smilePoints[j].y) / 3;
				oiface->at(i)->facialLandmarks->at(0).push_back(point);
			}
		}
		else if (i == 2) {
			for (int j = 0; j < pointsForMouth; j++) {
				openiss::Point2f point;
				point.x = smilePoints[j].x + (neutralPoints[j].x - smilePoints[j].x) * 2 / 3;
				point.y = smilePoints[j].y + (neutralPoints[j].y - smilePoints[j].y) * 2 / 3;
				oiface->at(i)->facialLandmarks->at(0).push_back(point);
			}
		}
		else if (i == 3) {
			for (int j = 0; j < pointsForMouth; j++) {
				oiface->at(i)->facialLandmarks->at(0).push_back(neutralPoints[j]);
			}
		}
		else if (i == 4) {
			for (int j = 0; j < pointsForMouth; j++) {
				openiss::Point2f point;
				point.x = neutralPoints[j].x + (frownPoints[j].x - neutralPoints[j].x) / 3;
				point.y = neutralPoints[j].y + (frownPoints[j].y - neutralPoints[j].y) / 3;
				oiface->at(i)->facialLandmarks->at(0).push_back(point);
			}
		}
		else if (i == 5) {
			for (int j = 0; j < pointsForMouth; j++) {
				openiss::Point2f point;
				point.x = neutralPoints[j].x + (frownPoints[j].x - neutralPoints[j].x) * 2 / 3;
				point.y = neutralPoints[j].y + (frownPoints[j].y - neutralPoints[j].y) * 2 / 3;
				oiface->at(i)->facialLandmarks->at(0).push_back(point);
			}
		}
		else if (i == 6) {
			for (int j = 0; j < pointsForMouth; j++) {
				oiface->at(i)->facialLandmarks->at(0).push_back(frownPoints[j]);
			}
		}
	}
}

int openiss::OINullDFaceTracker::getCurrentFace() const
{
	return currentFace;
}

vector<openiss::OIFace*>* openiss::OINullDFaceTracker::getOIFace() const
{
	return oiface;
}

void openiss::OINullDFaceTracker::setCurrentFace(int i)
{
	this->currentFace = i;
}

void openiss::OINullDFaceTracker::setOIFace(vector<OIFace*>* oif)
{
	this->oiface = oif;
}


openiss::OINullDFaceTracker::OINullDFaceTracker()
{
	//So next face called is 0
	currentFace = 6;

	//Initialize our collection of faces
	oiface = new vector<OIFace*>;

	//Generating the static faces
	generateFaces();
}

openiss::OINullDFaceTracker::OINullDFaceTracker(const OINullDFaceTracker& copied)
{
	this->currentFace = copied.currentFace;
	this->oiface = new vector<OIFace*>;
	this->oiface = copied.getOIFace();
}

openiss::OINullDFaceTracker::~OINullDFaceTracker()
{
	delete oiface;
}

//Assignment operator overload
openiss::OINullDFaceTracker& openiss::OINullDFaceTracker::operator=(OINullDFaceTracker& copied)
{
	this->currentFace = copied.currentFace;
	this->oiface = copied.oiface;
	return *this;
}

//This returns the next face in the vector
openiss::OIFace* openiss::OINullDFaceTracker::getNextFace()
{
	currentFace = (currentFace + 1) % 6;

	return oiface->at(currentFace);
}